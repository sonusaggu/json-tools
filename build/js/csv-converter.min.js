document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("json-input"),t=document.getElementById("csv-output"),n=document.getElementById("convert-btn"),c=document.getElementById("download-csv"),r=document.getElementById("copy-csv"),o=document.getElementById("include-headers"),d=document.getElementById("delimiter"),a=[{id:1,name:"Product A",price:19.99,stock:!0},{id:2,name:"Product B",price:29.99,stock:!1},{id:3,name:"Product C",price:39.99,stock:!0}];function i(){const t=e.value.split("\n");let n="";for(let e=0;e<t.length;e++)n+=e+1+"<br>";document.querySelector(".line-numbers").innerHTML=n}document.getElementById("sample-data").addEventListener("click",()=>{e.value=JSON.stringify(a,null,2),i()}),document.getElementById("clear-input").addEventListener("click",()=>{e.value="",t.textContent="CSV data will appear here...",i()}),n.addEventListener("click",()=>{const n=function(e,t=!0,n=","){try{const c="string"==typeof e?JSON.parse(e):e;if(!Array.isArray(c))throw new Error("Input must be a JSON array");return(t?Object.keys(c[0]).join(n)+"\n":"")+c.map(e=>Object.values(e).map(e=>"string"==typeof e&&(e.includes(n)||e.includes("\n"))?`"${e.replace(/"/g,'""')}"`:e).join(n)).join("\n")}catch(e){return`Error: ${e.message}`}}(e.value,o.checked,d.value);t.textContent=n,function(){const e=t.textContent.split("\n");let n="";for(let t=0;t<e.length;t++)n+=t+1+"<br>";document.querySelector(".output-line-numbers").innerHTML=n}()}),c.addEventListener("click",()=>{const e=t.textContent;if(!e||e.startsWith("Error:"))return;const n=new Blob([e],{type:"text/csv;charset=utf-8;"}),c=URL.createObjectURL(n),r=document.createElement("a");r.href=c,r.download="data.csv",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(c)}),r.addEventListener("click",()=>{const e=t.textContent;e&&!e.startsWith("Error:")&&navigator.clipboard.writeText(e).then(()=>{const e=r.querySelector("i");e.classList.replace("far","fas"),setTimeout(()=>e.classList.replace("fas","far"),2e3)})}),e.addEventListener("input",i),i()});