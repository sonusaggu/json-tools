document.addEventListener("DOMContentLoaded",function(){if("undefined"==typeof X2JS){const e="Error: Failed to load X2JS converter library. Please check your internet connection.";return console.error(e),void(document.getElementById("xml-output").textContent=e)}const e=document.getElementById("json-input"),t=document.getElementById("xml-output"),n=document.getElementById("convert-btn"),r=document.getElementById("download-xml"),o=document.getElementById("copy-xml"),a=document.getElementById("pretty-print"),l=document.getElementById("root-element"),c=new X2JS({escapeMode:!0,attributePrefix:"_",enableToStringFunc:!0,arrayAccessForm:"property",emptyNodeForm:"text"}),i={person:{name:"John Doe",age:30,address:{street:"123 Main St",city:"New York"},emails:["john@example.com","j.doe@work.com"],metadata:{_created:"2023-01-01",modified:"2023-05-15"}}};function d(){const t=e.value.split("\n");let n="";for(let e=0;e<t.length;e++)n+=e+1+"<br>";document.querySelector(".line-numbers").innerHTML=n}document.getElementById("sample-data").addEventListener("click",()=>{e.value=JSON.stringify(i,null,2),d()}),document.getElementById("clear-input").addEventListener("click",()=>{e.value="",t.textContent="XML data will appear here...",d()}),n.addEventListener("click",()=>{if(!e.value.trim())return void(t.textContent="Error: Please enter JSON data first");const n=function(e,t=!0,n="root"){try{if(!e.trim())throw new Error("Input is empty");const r=JSON.parse(e),o=c.js2xml(r);if(!o)throw new Error("Conversion failed - invalid JSON structure");let a='<?xml version="1.0" encoding="UTF-8"?>';return a+=t?"\n"+function(e){let t="",n="",r=!1,o=!1;return e.split("").forEach(e=>{"<"===e?(r&&(t+="\n"+n),t+=e,r=!0,o=!1):">"===e?(t+=e,r=!1,o=!1):r&&" "===e?(o||(t+="\n"+n+"  ",o=!0),t+=e):"\n"===e||"\r"===e||(t+=e,'"'===e&&(o=!o))}),t.replace(/\n\s*\n/g,"\n").trim()}(`<${n}>${o}</${n}>`):`<${n}>${o}</${n}>`,a}catch(e){return console.error("Conversion error:",e),`Error: ${e.message}\n\nPlease check:\n1. Valid JSON format\n2. No trailing commas\n3. Properly quoted property names`}}(e.value,a.checked,l.value);t.textContent=n,function(){const e=t.textContent.split("\n");let n="";for(let t=0;t<e.length;t++)n+=t+1+"<br>";document.querySelector(".output-line-numbers").innerHTML=n}()}),r.addEventListener("click",()=>{const e=t.textContent;if(e&&!e.startsWith("Error:"))try{const t=new Blob([e],{type:"application/xml;charset=utf-8"}),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download=`converted_${(new Date).getTime()}.xml`,document.body.appendChild(r),r.click(),setTimeout(()=>{document.body.removeChild(r),URL.revokeObjectURL(n)},100)}catch(e){console.error("Download failed:",e),alert("Download failed: "+e.message)}else alert("Please generate valid XML first")}),o.addEventListener("click",()=>{const e=t.textContent;e&&!e.startsWith("Error:")?navigator.clipboard.writeText(e).then(()=>{const e=o.querySelector("i");e.classList.replace("far","fas"),setTimeout(()=>e.classList.replace("fas","far"),2e3)}).catch(e=>{console.error("Copy failed:",e),alert("Failed to copy XML to clipboard")}):alert("Please generate valid XML first")}),e.addEventListener("input",d),d()});